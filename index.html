<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<meta name="theme-color" content="#f8e7ef">

<title>La Do√ßura | Card√°pio Digital</title>

<meta name="description" content="Clique para ver nossos doces, montar seu pedido e se encantar. Feito com carinho para voc√™!">
<meta property="og:title" content="La Do√ßura | Card√°pio de Del√≠cias üç∞">
<meta property="og:description" content="Clique para ver nossos doces, montar seu pedido e se encantar. Feito com carinho para voc√™!">
<meta property="og:image" content="https://i.postimg.cc/94nCdB6P/logo.jpg"> 
<meta property="og:type" content="website">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Great+Vibes&display=swap" rel="stylesheet">
<style>
:root{
  --rose-50:#fff8fb; --rose-100:#fdeff4; --rose-200:#f8dbe7; --rose-300:#f4a7c5; --rose-400:#e77aa6;
  --choco:#4b2e2e; --ink:#6b4b4b; --ok:#059669; --ok-300:#34d399;
  --gold-300:#e2c38c; --gold-500:#b8903c; --red-400:#fb7185;
  --radius:18px; --shadow:0 12px 28px rgba(0,0,0,.08);
}
*{box-sizing:border-box} html,body{margin:0}
body{font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#3b2b2b;background:radial-gradient(1400px 280px at 50% -120px,var(--rose-100),transparent),linear-gradient(180deg,var(--rose-50),#fff 40%)}
a{color:inherit; text-decoration:none;} .container{max-width:960px;margin:0 auto;padding:0 16px} .pink{color:var(--rose-400)}
.topbar{position:sticky;top:0;z-index:60;background:#fff8fbf2;backdrop-filter:blur(6px);border-bottom:1px solid #f3d9e4}
.nav{display:flex;align-items:center;justify-content:space-between;height:64px}
.brand{display:flex;align-items:center;gap:12px;text-decoration:none;color:var(--choco)}
.brand-logo{height:56px; width:56px; object-fit:contain;}
.brand-name{font-family:"Great Vibes",cursive;font-size:32px}
.cart-btn{position:relative;display:inline-flex;align-items:center;gap:10px;border:0;background:transparent;cursor:pointer}
.cart-badge{width:38px;height:38px;border-radius:12px;display:grid;place-items:center;background:conic-gradient(from 220deg at 50% 50%, #ffd9e6, #ffc9dc, #ffdce9);border:1.5px solid #f4cbd7; box-shadow:0 6px 14px rgba(231,161,189,.25)}
.cart-badge svg{width:20px;height:20px;fill:#7e3a54}
.cart-count{position:absolute;right:-6px;top:-6px;min-width:20px;height:20px;border-radius:999px;background:linear-gradient(135deg,var(--rose-300),var(--rose-400));color:#fff;display:grid;place-items:center;padding:0 6px;font-size:12px;font-weight:800;border:2px solid #fff}
.cart-badge.jiggle{animation:jiggle .5s ease} @keyframes jiggle{0%,100%{transform:scale(1)}25%{transform:scale(1.15) rotate(5deg)}75%{transform:scale(.95) rotate(-5deg)}}
.hero{padding:28px 0 12px; position:relative; overflow:hidden; text-align:center;}
.hero h1{margin:0 0 8px;color:var(--choco);font-size:clamp(24px,6vw,42px);line-height:1.15}
.subtitle{color:#6a4a4a;margin:0 0 18px;font-size:clamp(15px,3.6vw,18px)}
.section{padding:18px 0}
.menu-controls{position:sticky;top:64px;z-index:40;background:linear-gradient(180deg,#fff8fb,#fff);border-bottom:1px solid #f3d9e4;padding:10px 0 12px;margin-bottom:10px}
.searchbar input{width:100%;padding:12px 14px;border:1.5px solid #f1c9d8;border-radius:12px;font:inherit}
.searchbar input:focus{outline:none;border-color:var(--rose-300);box-shadow:0 0 0 3px rgba(244,167,197,.25)}
.chips{display:flex;gap:8px;overflow:auto;padding:8px 2px; scrollbar-width: none;} .chips::-webkit-scrollbar { display: none; }
.chips button{border:1.5px solid #f4cbd7;background:#fff;border-radius:999px;padding:8px 12px;font-weight:800;color:#7e3a54;cursor:pointer;white-space:nowrap}
.chips button.active{background:linear-gradient(135deg,var(--rose-300),var(--rose-400));color:#fff}
.stack{display:grid;gap:16px;grid-template-columns:repeat(auto-fill,minmax(280px,1fr))}
.card{background:#fff;border:1px solid #f4d6df;border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);position:relative;cursor:pointer;transition:transform .2s ease, box-shadow .2s ease}
.card:hover{transform:translateY(-4px);box-shadow:0 16px 30px rgba(231,161,189,.22)}
.card-img{width:100%;height:180px;background:linear-gradient(135deg,#ffeaf2,#ffd6e6)}
.card-img img{width:100%;height:100%;object-fit:cover;display:block}
.card-body{padding:14px}
.product-title{margin:0 0 6px;font-size:18px;line-height:1.25;color:#5a3a5a;font-weight:800}
.product-desc{font-size:14px;color:var(--ink);margin:0 0 10px;min-height:40px}
.price-line{margin:2px 0 2px;color:#573333;font-weight:700}
.price-line strong{font-size:18px}
.btn{--bg1: var(--rose-300); --bg2: var(--rose-400);display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 18px;border-radius:14px;border:0;color:#fff;font-weight:900;cursor:pointer;background:linear-gradient(135deg,var(--bg1),var(--bg2));position:relative;box-shadow:0 10px 18px rgba(231,161,189,.25);transition:transform .15s ease, box-shadow .15s ease}
.btn:hover{transform:translateY(-1px);box-shadow:0 12px 22px rgba(231,161,189,.32)}
.btn-outline{background:#fff;color:#7e3a54;border:2px solid #e7a1bd;box-shadow:none}
.btn.added{--bg1:var(--ok-300);--bg2:var(--ok); box-shadow:0 10px 18px rgba(5, 150, 105, .25);}
.drawer{position:fixed;inset:auto 0 0 auto;top:0;right:-420px;width:min(400px,92%);height:100%;background:#fff;border-left:1px solid #f4d6df;box-shadow:-12px 0 24px rgba(0,0,0,.12);transition:right .28s ease;z-index:80;display:flex;flex-direction:column}
.drawer.open{right:0}
.drawer-header{position:sticky;top:0;background:#fff;padding:14px;border-bottom:1px solid #f3d9e4;display:flex;align-items:center;justify-content:space-between;z-index:1; flex-shrink: 0;}
.drawer-title{font-weight:900;color:#4b2e2e;font-size:20px}
.drawer-close{background:transparent;border:0;font-size:24px;cursor:pointer;padding:0;line-height:1}
.drawer-body{padding:12px 14px;overflow:auto;flex:1}
.cart-item{border-bottom:1px dashed #f1c9d8;padding:12px 0; overflow:hidden; transition:opacity .3s ease, max-height .3s ease, padding .3s ease}
.cart-item.removing{opacity:0; max-height:0; padding-top:0; padding-bottom:0; margin-bottom:-1px; border:0;}
.item-row{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:start}
.item-info h4{margin:0 0 6px;font-size:16px;font-weight:800;color:#5a3a5a}
.item-info .muted{color:#7c6a6a;font-size:13px;margin:2px 0}
.item-extras{font-size:13px;color:#7c6a6a;margin:4px 0 0;padding-left:14px;border-left:2px solid #f3d9e4}
.qty-col{display:flex;flex-direction:column;align-items:flex-end;gap:8px}
.qty-ctl{display:inline-flex;align-items:center;gap:6px}
.qty-ctl button{width:30px;height:30px;border-radius:8px;border:1px solid #f1c9d8;background:#fff;cursor:pointer;font-weight:800;color:#7e3a54}
.rmv{background:#fff;border:1px solid #f4cbd7;border-radius:999px;padding:8px 12px;cursor:pointer;font-weight:800;color:#7e3a54}
.total-line{display:flex; justify-content: space-between; font-size: 16px; margin: 8px 0;}
.total-line.grand-total { font-size: 18px; font-weight: 900; color: var(--choco); }
.mobile-bar{position:sticky;bottom:0;z-index:50;background:#fff;border-top:1px solid #f3d9e4}
.mobile-bar .wrap{max-width:960px;margin:0 auto;padding:10px 16px;display:flex;gap:10px;align-items:center;justify-content:space-between}
.mobile-bar .subtotal{font-weight:800;color:#5a3a5a}
.modal-overlay{ position:fixed; inset:0; background:rgba(75,46,46,.4); backdrop-filter:blur(4px); z-index:100; display:flex; align-items:flex-end; justify-content:center; opacity:0; pointer-events:none; transition:opacity .25s ease; }
.modal-overlay.show{opacity:1; pointer-events:auto}
.modal-box{ background:#fff; padding-top:16px; border-radius:var(--radius) var(--radius) 0 0; box-shadow:0 -10px 40px rgba(0,0,0,.2); width:min(500px, 100%); transform:translateY(100%); transition:transform .3s ease, opacity .3s ease; max-height:90vh; display:flex; flex-direction:column;}
.modal-overlay.show .modal-box{transform:translateY(0)}
.modal-box.is-dragging{transition:none;}
.modal-drag-area{position:relative; flex-shrink:0; touch-action:none;}
.modal-drag-area:before{content:''; position:absolute; top:-8px; left:50%; transform:translateX(-50%); width:40px; height:4px; background:#e0e0e0; border-radius:2px;}
.modal-img{width:100%; height:200px; object-fit:cover;}
.modal-close{background:var(--rose-50); color:var(--rose-400); border:1px solid var(--rose-200); width:36px; height:36px; border-radius:50%; cursor:pointer; font-weight:bold; position:absolute; top:12px; right:12px; z-index:1; display:grid; place-items:center; font-size:18px; box-shadow: 0 4px 12px rgba(0,0,0,.1);}
.modal-body{padding:16px; flex:1; overflow-y:auto}
.modal-body h3{font-size:22px; margin:0 0 8px; color:var(--choco)}
.modal-body .desc{font-size:15px; color:var(--ink); margin-bottom:16px}
.modal-body .option-group{margin:16px 0}
.modal-body label{font-weight:700; color:var(--choco); display:block; margin-bottom:8px}
.modal-body .form-input, .modal-body select{width:100%;padding:12px;border-radius:12px;border:1.5px solid #f1c9d8;background:#fff;font:inherit;color:#4b2e2e}
.mod-line{display:flex;align-items:center;justify-content:space-between;border:1px solid #f4cbd7;border-radius:10px;padding:12px;margin-bottom:8px}
.mod-line label{display:flex;align-items:center;gap:10px;font-weight:600;color:#5a3a5a;margin:0}
.modal-footer{padding:16px; border-top:1px solid #f3d9e4; display:flex; justify-content:space-between; align-items:center; gap:16px; flex-shrink:0}
.modal-price{font-size:20px; font-weight:800; color:var(--choco)}
#modalAddToCartBtn{width:100%; flex:1}
.info-box{background:var(--rose-50); border:1px solid var(--rose-200); border-radius:12px; padding:10px; display:flex; align-items:center; gap:10px; font-size:14px; color:var(--ink); margin-top:12px;}
.info-box svg{width:20px;height:20px;fill:var(--rose-400);flex-shrink:0;}
.drawer .form-input, .drawer select, .drawer input[type="date"], .drawer input[type="time"]{width:100%;padding:12px;border:1.5px solid #f1c9d8;border-radius:12px; font:inherit;color:#4b2e2e;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.05)}
.drawer .form-input:focus, .drawer select:focus, .drawer input[type="date"]:focus, .drawer input[type="time"]:focus{border-color:var(--rose-300);box-shadow:0 0 0 3px rgba(244,167,197,.25);outline:none}
.drawer h3 { font-size: 16px; font-weight: 800; color: var(--choco); margin: 20px 0 10px; }
.drawer .f-label {display:flex;align-items:center;gap:8px;margin:12px 0 6px;font-weight:800;color:#4b2e2e}
.drawer .f-label span { font-size: 15px; font-weight: 700; }
.drawer .muted { font-size: 13px; line-height: 1.4; }
.drawer .form-input::placeholder { font-size: 15px; font-weight: 500; }
.drawer .coupon-area{margin-top:10px}
.drawer .coupon-input-wrap{display:flex;gap:8px}
.drawer #couponMessage{font-size:13px;font-weight:700;margin-top:8px;text-align:center}
.drawer-footer {padding: 14px;border-top: 1px solid #f3d9e4;background: #fff;display: grid;gap: 10px;flex-shrink: 0;}
.cep-wrap{position:relative;display:flex;align-items:center}
.cep-spinner{ position:absolute; right:12px; width:18px; height:18px; border:2px solid var(--rose-200); border-top-color:var(--rose-400); border-radius:50%; animation:spin .8s linear infinite; opacity:0; visibility:hidden; transition:opacity .2s, visibility .2s; }
.cep-spinner.loading{opacity:1; visibility:visible}
@keyframes spin{to{transform:rotate(360deg)}}
.invalid-field{ border-color:#fb7185 !important; animation:shake .4s ease-in-out; }
@keyframes shake{ 0%,100%{transform:translateX(0)} 25%{transform:translateX(-4px)} 75%{transform:translateX(4px)} }
.address-grid { display: grid; gap: 8px; grid-template-columns: 1fr; }
@media (min-width: 480px) { .address-grid { grid-template-columns: 1.2fr 1fr .8fr; } }
</style>
</head>
<body>
<header class="topbar">
  <div class="container nav">
    <a class="brand" href="#top">
      <img src="https://i.postimg.cc/94nCdB6P/logo.jpg" alt="Logo La Do√ßura" class="brand-logo">
      <span class="brand-name">La Do√ßura</span>
    </a>
    <button class="cart-btn" id="openCart"><span class="cart-badge"><svg viewBox="0 0 24 24"><path d="M7 7V6a5 5 0 0110 0v1h1.5a1.5 1.5 0 011.49 1.32l1.2 9.6A3 3 0 0118.23 21H5.77a3 3 0 01-2.96-3.08l1.2-9.6A1.5 1.5 0 015.5 7H7zm2 0h6V6a3 3 0 10-6 0v1z"/></svg></span><span class="cart-count" id="cartCount">0</span></button>
  </div>
</header>

<main>
  <section class="hero" id="top">
    <div class="container" style="position:relative; z-index:1;">
      <h1>Feitos com carinho, <span class="pink">servidos com do√ßura</span></h1>
      <p class="subtitle">Seu momento doce come√ßa aqui. Explore nossas del√≠cias artesanais.</p>
      <div class="info-box">
        <svg viewBox="0 0 24 24"><path d="M12 2a10 10 0 100 20 10 10 0 000-20zm0 18a8 8 0 110-16 8 8 0 010 16zm-1-12h2v6h-2V8zm0 8h2v2h-2v-2z"></path></svg>
        <span>Lembrete: Para garantir a qualidade, pedimos 24h de anteced√™ncia para pedidos.</span>
      </div>
    </div>
  </section>

  <div class="menu-controls">
    <div class="container">
      <div class="searchbar"><input id="searchInput" type="search" placeholder="Buscar no card√°pio‚Ä¶" aria-label="Buscar"></div>
      <div class="chips" id="chips"></div>
    </div>
  </div>

  <section id="menu" class="section">
    <div class="container">
      <div class="stack" id="menuStack"></div>
    </div>
  </section>
</main>

<div class="mobile-bar">
  <div class="wrap">
    <div class="subtotal" id="mobileSubtotal" aria-live="polite">Subtotal: R$ 0,00</div>
    <button class="btn" id="viewCartBtn">Ver carrinho</button>
  </div>
</div>

<footer style="background:linear-gradient(180deg,#fff,var(--rose-100));border-top:1px solid #f2d5e0;padding:22px 0;color:#664a4a;font-size:14px">
  <div class="container" style="display:flex;gap:12px;justify-content:space-between;align-items:center;flex-wrap:wrap">
    <div><strong>La Do√ßura</strong> ‚Ä¢ Feitos com carinho, <span class="pink">servidos com do√ßura</span>.</div>
    <div>¬© <span id="y"></span> ‚Ä¢ <a href="#menu" style="color:#7e3a54;font-weight:700;text-decoration:none">Menu</a></div>
  </div>
</footer>

<aside class="drawer" id="drawer" aria-label="Carrinho">
  <div class="drawer-header">
    <div class="title-wrap"><div class="drawer-title">Seu Carrinho</div></div>
    <button class="drawer-close" id="closeTop" aria-label="Fechar carrinho">‚úñ</button>
  </div>

  <div class="drawer-body">
    <div id="cartItems"></div>

    <div class="cart-summary">
      <div id="totals-section">
        <div class="total-line">
            <span>Subtotal:</span>
            <span id="subtotalValue">R$ 0,00</span>
        </div>
        <div class="total-line" id="delivery-fee-line" style="display: none;">
            <span>Taxa de Entrega:</span>
            <span id="deliveryFeeValue">A calcular</span>
        </div>
        <div class="total-line" id="discount-line" style="display: none;">
            <span>Desconto:</span>
            <span id="discountValue">R$ 0,00</span>
        </div>
        <div class="total-line grand-total">
            <span>Total Geral:</span>
            <span id="grandTotalValue">R$ 0,00</span>
        </div>
      </div>
      
      <div class="coupon-area">
        <label for="couponInput" class="f-label"><span class="ficon">üéüÔ∏è</span><span>Tem um cupom?</span></label>
        <div class="coupon-input-wrap">
            <input type="text" id="couponInput" class="form-input" placeholder="Digite seu cupom">
            <button type="button" class="btn btn-outline" id="applyCouponBtn">Aplicar</button>
        </div>
        <div id="couponMessage"></div>
      </div>

      <div class="block-sep" style="margin:12px 0 10px;border-top:2px solid transparent;border-image:linear-gradient(90deg,var(--gold-300),var(--gold-500)) 1"></div>

      <h3>üöö Entrega ou Retirada</h3>
      <div class="segmented" role="tablist" aria-label="Modalidade" style="display:inline-flex;border:2px solid #f0b8cf;border-radius:16px;overflow:hidden;background:#fff;box-shadow:0 6px 16px rgba(231,161,189,.15)">
        <button type="button" data-mode="retirada" class="active" aria-selected="true" style="border:0;padding:12px 18px;background:transparent;font-weight:900;color:#7e3a54;cursor:pointer;font-size:15px">Retirada</button>
        <button type="button" data-mode="entrega" aria-selected="false" style="border:0;padding:12px 18px;background:transparent;font-weight:900;color:#7e3a54;cursor:pointer;font-size:15px">Entrega</button>
      </div>

      <div class="delivery-box-container" data-mode-box="retirada" style="display: grid; transition: grid-template-rows 0.35s ease-in-out; grid-template-rows: 1fr;">
        <div class="delivery-box" style="overflow: hidden;">
          <p class="muted" style="margin-top:12px"><strong>Local:</strong> Rua Jos√© Faid, 800 ‚Äî Jardim Santana, Porto Velho/RO</p>
          <a href="https://maps.app.goo.gl/iNEEjprE68qSqhhd9" target="_blank" rel="noopener" class="btn btn-outline" style="gap:8px">üìç Abrir no Google Maps</a>
          <div style="height:8px"></div>
          <label for="nomeRetirada" class="f-label"><span class="ficon">üìù</span><span>Nome para retirada *</span></label>
          <input type="text" id="nomeRetirada" class="form-input" placeholder="Ex.: Maria Silva">
        </div>
      </div>

      <div class="delivery-box-container" data-mode-box="entrega" style="display: grid; transition: grid-template-rows 0.35s ease-in-out; grid-template-rows: 0fr;">
        <div class="delivery-box" style="overflow: hidden;">
          <p class="muted" style="margin-top:12px">A taxa de entrega √© calculada com base na dist√¢ncia.</p>
          <label for="nomeEntrega" class="f-label"><span class="ficon">üìù</span><span>Nome para entrega *</span></label>
          <input type="text" id="nomeEntrega" class="form-input" placeholder="Ex.: Maria Silva">
          
          <div class="cep-wrap">
            <label class="f-label" for="cep"><span class="ficon">üìÆ</span><span>CEP (opcional)</span></label>
            <input type="text" id="cep" class="form-input" placeholder="00000-000" inputmode="numeric" maxlength="9">
            <div class="cep-spinner" id="cepSpinner"></div>
          </div>
          
          <div class="address-grid" style="margin-top:8px">
            <div>
              <label class="f-label" for="rua"><span class="ficon">üõ£Ô∏è</span><span>Rua *</span></label>
              <input type="text" id="rua" class="form-input" placeholder="Av. Exemplo">
            </div>
            <div>
              <label class="f-label" for="bairro"><span class="ficon">üèòÔ∏è</span><span>Bairro *</span></label>
              <input type="text" id="bairro" class="form-input" placeholder="Jardim Santana">
            </div>
            <div>
              <label class="f-label" for="numero"><span class="ficon">üî¢</span><span>N√∫mero *</span></label>
              <input type="text" id="numero" class="form-input" placeholder="800" inputmode="numeric">
            </div>
          </div>

          <div>
              <label class="f-label" for="ref"><span class="ficon">üìå</span><span>Refer√™ncia (opcional)</span></label>
              <input type="text" id="ref" class="form-input" placeholder="Ex.: Apto, bloco, pr√≥ximo √†...">
          </div>
          <button type="button" class="btn" id="calculateFeeBtn" style="width:100%; margin-top: 16px;">
            <svg style="width:20px; height:20px" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path></svg>
            <span>Calcular Frete</span>
          </button>
        </div>
      </div>

      <div class="datetime-block">
        <h3>üóìÔ∏è Pedido</h3>
        <div class="info-box" style="background: var(--rose-50); border: 1px solid var(--rose-200); border-radius: 12px; padding: 10px; margin: 8px 0; display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--ink);">
          <svg viewBox="0 0 24 24" style="width: 20px; height: 20px; fill: var(--rose-400); flex-shrink: 0;"><path d="M12 2a10 10 0 100 20 10 10 0 000-20zm0 18a8 8 0 110-16 8 8 0 010 16zm-1-12h2v6h-2V8zm0 8h2v2h-2v-2z"></path></svg>
          <span>Lembrete: Pedidos com no m√≠nimo 24h de anteced√™ncia.</span>
        </div>
        <div style="display: grid; gap: 8px; grid-template-columns: 1fr 1fr; margin-top:8px">
            <div>
                <label class="f-label" for="date"><span class="ficon">üóìÔ∏è</span><span>Data</span></label>
                <input type="date" id="date" class="form-input" />
            </div>
            <div>
                <label class="f-label" for="time"><span class="ficon">‚è∞</span><span>Hor√°rio</span></label>
                <input type="time" id="time" class="form-input" />
            </div>
        </div>
      </div>

      <div style="margin-top:10px">
        <label class="f-label" for="obs"><span class="ficon">‚úçÔ∏è</span><span>Observa√ß√µes (opcional)</span></label>
        <textarea id="obs" class="form-input" rows="2" placeholder="Ex.: Anivers√°rio, prefer√™ncias..."></textarea>
      </div>
    </div>
  </div>

  <div class="drawer-footer">
    <button class="btn" id="checkoutBtn">Finalizar o pedido</button>
    <button class="btn btn-outline" id="continueBtn">Continuar escolhendo</button>
  </div>
</aside>

<div class="modal-overlay" id="productModal">
  <div class="modal-box" id="modalBox">
    <div class="modal-drag-area">
      <button class="modal-close" id="modalCloseBtn">‚úñ</button>
      <img src="" id="modalImg" class="modal-img" alt="">
    </div>
    <div class="modal-body">
        <h3 id="modalTitle"></h3>
        <p id="modalDesc"></p>
        <form id="modalForm"></form>
    </div>
    <div class="modal-footer">
        <div class="modal-price" id="modalPrice"></div>
        <button class="btn" id="modalAddToCartBtn">Adicionar ao pedido</button>
    </div>
  </div>
</div>

<script>
// --- 1. CONFIG & STATE ---
const PHONE="556992702283";
const MAP_LINK="https://maps.app.goo.gl/iNEEjprE68qSqhhd9";
const MENU = {
  tradicionais: {
    title: 'Brigadeiros Tradicionais',
    image: 'https://i.imgur.com/EDSsPWe.jpeg',
    description: "Feito com leite condensado de qualidade, manteiga e cacau em p√≥, enrolado no mais puro granulado de chocolate.",
    quantities: ['50', '100'],
    flavors: { Chocolate: { '50': 45, '100': 80 }, Morango: { '50': 40, '100': 70 }, Beijinho: { '50': 40, '100': 70 }, 'Leite Ninho': { '50': 40, '100': 70 } },
    mods: [ { id: 'granulado_belga', label: 'Granulado Belga', price: 5 }, { id: 'caixa_presente_trad', label: 'Caixa para Presente', price: 8 } ]
  },
  gourmet: {
    title: 'Brigadeiros Gourmet',
    image: 'https://i.imgur.com/PGPaYnR.jpeg',
    description: "Uma deliciosa op√ß√£o com produtos selecionados e decora√ß√µes √∫nicas que encantam no sabor e no visual. Vale a pena experimentar!",
    quantities: ['50', '100'],
    flavors: { 'Prest√≠gio': { '50': 85, '100': 170 }, 'Dois Amores': { '50': 85, '100': 170 }, 'Pa√ßoca': { '50': 85, '100': 170 }, 'Ferrero Rocher': { '50': 85, '100': 170 }, 'Leite Ninho com Nutella': { '50': 85, '100': 170 } },
    mods: [ { id: 'nutella_extra', label: 'Nutella Extra', price: 10 }, { id: 'caixa_presente_gourmet', label: 'Caixa para Presente Luxo', price: 12 } ]
  },
  personalizados: {
    title: 'Brigadeiros Personalizados',
    image: 'https://i.imgur.com/cVwbpK7.jpeg',
    description: "Feito com leite condensado e creme de leite, √© finalizado com uma personaliza√ß√£o linda e exclusiva para o seu evento.",
    quantities: ['50', '100'],
    flavors: { '18g': { '50': 95, '100': 180 }, '23g': { '50': 125, '100': 220 } },
    extra: 'tema',
    mods: []
  },
  lembrancinhas: {
    title: 'Lembrancinhas de Brownie',
    image: 'https://i.imgur.com/VBQJZvB.jpeg',
    description: "Uma explos√£o de sabor! Feita com chocolate de qualidade e recheada com uma grande op√ß√£o de sabores super saborosos.",
    quantities: ['10', '50'],
    flavors: { 'Maracuj√°': { '10': 60, '50': 300 }, 'Pa√ßoca': { '10': 60, '50': 300 }, 'Doce de Leite': { '10': 60, '50': 300 } },
    mods: [ { id: 'tag_personalizada', label: 'Tag com Nome/Data', price: 8 } ]
  },
  minibrownie: {
    title: 'Mini Brownie',
    image: 'https://i.imgur.com/l4dmGwS.jpeg',
    description: "Deliciosamente macios, preparados com chocolate premium e um toque especial. Perfeitos para deixar sua festa mais linda e saborosa.",
    quantities: ['50', '100'],
    flavors: { 'Chocolate': { '50': 110, '100': 219 }, 'Maracuj√°': { '50': 110, '100': 210 }, 'Leite Ninho': { '50': 110, '100': 210 } },
    mods: []
  },
  colher: {
    title: 'Brigadeiros de Colher',
    image: 'https://i.imgur.com/EJi0yZ2.jpeg',
    description: "A cremosidade que derrete na boca. Ideal para comer sem modera√ß√£o.",
    quantities: ['50', '100'],
    flavors: { 'Chocolate': { '50': 40, '100': 70 },'Beijinho': { '50': 40, '100': 70 },'Bicho de P√©': { '50': 40, '100': 70 } },
    mods: []
  },
  copo: {
    title: 'Mini Copo Bolha',
    image: 'https://i.imgur.com/iie6pqD.jpeg',
    description: "A sobremesa que tamb√©m decora sua festa. Uma explos√£o de sabores.",
    quantities: ['10', '50'],
    flavors: { 'Frutas Vermelhas': { '10': 25, '50': 110 }, 'Brownie': { '10': 25, '50': 110 }, 'Torta de Lim√£o': { '10': 25, '50': 110 } },
    mods: []
  }
};
let cart=[]; 
let additions=0;
let deliveryFee = 0;
let appliedCoupon = null;
let discountAmount = 0;
const CART_KEY='ladocura_cart_v2';

// --- 2. ELEMENT SELECTORS ---
const menuStack = document.getElementById('menuStack');
const chipsEl = document.getElementById('chips');
const productModal = document.getElementById('productModal');
const modalBox = document.getElementById('modalBox');
const modalForm = document.getElementById('modalForm');
const modalPriceEl = document.getElementById('modalPrice');
const cartItemsEl=document.getElementById('cartItems');
const subtotalValueEl = document.getElementById('subtotalValue');
const deliveryFeeLineEl = document.getElementById('delivery-fee-line');
const deliveryFeeValueEl = document.getElementById('deliveryFeeValue');
const discountLineEl = document.getElementById('discount-line');
const discountValueEl = document.getElementById('discountValue');
const grandTotalValueEl = document.getElementById('grandTotalValue');
const cartCountEl=document.getElementById('cartCount');
const mobileSubtotal=document.getElementById('mobileSubtotal');
const cartBadgeEl = document.querySelector('#openCart .cart-badge');
const drawer=document.getElementById('drawer');
const dateInput = document.getElementById('date');
const timeInput = document.getElementById('time');
const cepInput=document.getElementById('cep');
const ruaInput=document.getElementById('rua');
const bairroInput=document.getElementById('bairro');
const numeroInput = document.getElementById('numero');
const cepSpinner = document.getElementById('cepSpinner');
const couponInput = document.getElementById('couponInput');
const couponMessageEl = document.getElementById('couponMessage');

// --- 3. HELPER FUNCTIONS ---
const moneyBR=v=>`R$ ${v.toFixed(2).replace('.',',')}`;
const onlyDigits=s=>(s||'').replace(/\D+/g,''); 
const pad2=n=>String(n).padStart(2,'0');
const toLocalInputValue=d=>`${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
const formatBR=d=>`${pad2(d.getDate())}/${pad2(d.getMonth()+1)}/${d.getFullYear()}`;

function showModal(text, icon='üå∏'){
  alert(`${icon} ${text.replace(/<br>/g, '\n').replace(/<strong>|<\/strong>/g, '')}`);
}

// --- 4. CORE APPLICATION LOGIC ---
// (Fun√ß√µes de UI: renderMenu, setupFilters, openProductModal, etc.)
function renderMenu() {
  menuStack.innerHTML = '';
  Object.entries(MENU).forEach(([key, cfg]) => {
    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.key = key;
    const minPrice = Math.min(...Object.values(cfg.flavors).flatMap(q => Object.values(q)));
    card.innerHTML = `
      <div class="card-img"><img src="${cfg.image}" alt="${cfg.title}" loading="lazy"></div>
      <div class="card-body">
        <h3 class="product-title">${cfg.title}</h3>
        <p class="product-desc">${cfg.description}</p>
        <div class="price-line">A partir de <strong>${moneyBR(minPrice)}</strong></div>
      </div>
    `;
    card.onclick = () => openProductModal(key);
    menuStack.appendChild(card);
  });
}

function setupFilters() {
  chipsEl.innerHTML = '<button type="button" class="active" data-filter="all">Todos</button>';
  Object.keys(MENU).forEach(key => {
    const b = document.createElement('button');
    b.textContent = MENU[key].title;
    b.dataset.filter = key;
    chipsEl.appendChild(b);
  });
  chipsEl.querySelectorAll('button').forEach(b => {
    b.onclick = (e) => {
      e.stopPropagation();
      const filter = b.dataset.filter;
      chipsEl.querySelectorAll('button').forEach(x => x.classList.remove('active'));
      b.classList.add('active');
      menuStack.querySelectorAll('.card').forEach(card => {
        card.style.display = (filter === 'all' || card.dataset.key === filter) ? '' : 'none';
      });
    };
  });
  document.getElementById('searchInput').addEventListener('input', e => {
    const query = e.target.value.toLowerCase();
    chipsEl.querySelector('[data-filter="all"]').click();
    menuStack.querySelectorAll('.card').forEach(card => {
        const cfg = MENU[card.dataset.key];
        const searchText = `${cfg.title} ${cfg.description} ${Object.keys(cfg.flavors).join(' ')}`.toLowerCase();
        card.style.display = searchText.includes(query) ? '' : 'none';
    });
  });
}

function openProductModal(key) {
  currentProductKey = key;
  const cfg = MENU[key];
  document.getElementById('modalImg').src = cfg.image;
  document.getElementById('modalTitle').textContent = cfg.title;
  document.getElementById('modalDesc').textContent = cfg.description;
  
  let formHTML = `<div class="option-group">
    <label>${cfg.extra === 'tema' ? 'Peso' : 'Sabor'}</label>
    <select name="flavor" class="form-input">${Object.keys(cfg.flavors).map(f => `<option value="${f}">${f}</option>`).join('')}</select>
  </div>
  <div class="option-group">
    <label>Quantidade</label>
    <select name="qty" class="form-input">${cfg.quantities.map(q => `<option value="${q}">${q} unidades</option>`).join('')}</select>
  </div>`;
  if (cfg.extra === 'tema') {
    formHTML += `<div class="option-group"><label>Tema da festa (opcional)</label><input type="text" name="tema" class="form-input" placeholder="Ex: Unic√≥rnio, Mickey..."></div>`;
  }
  if (cfg.mods && cfg.mods.length > 0) {
    formHTML += `<div class="option-group"><label>Adicionais</label>${cfg.mods.map(m => `<div class="mod-line"><label><input type="checkbox" name="mods" value="${m.id}" data-price="${m.price}"> ${m.label}</label><strong>+ ${moneyBR(m.price)}</strong></div>`).join('')}</div>`;
  }
  
  modalForm.innerHTML = formHTML;
  modalForm.onchange = () => updateModalPrice();
  updateModalPrice();
  productModal.classList.add('show');
}

function updateModalPrice() {
  if(!currentProductKey) return;
  const cfg = MENU[currentProductKey];
  const flavor = modalForm.querySelector('[name="flavor"]').value;
  const qty = modalForm.querySelector('[name="qty"]').value;
  let basePrice = cfg.flavors[flavor]?.[qty] || 0;
  let modsPrice = 0;
  modalForm.querySelectorAll('[name="mods"]:checked').forEach(mod => { modsPrice += parseFloat(mod.dataset.price); });
  modalPriceEl.textContent = moneyBR(basePrice + modsPrice);
}

function closeModal() {
  modalBox.style.transform = 'translateY(100%)';
  productModal.style.opacity = '0';
  setTimeout(() => {
    productModal.classList.remove('show');
    modalBox.style.transform = '';
    modalBox.style.opacity = '';
    currentProductKey = null;
  }, 300);
}

// (Fun√ß√µes de L√≥gica do Carrinho - a maioria restaurada do original)
function persist(){localStorage.setItem(CART_KEY,JSON.stringify({cart,additions,appliedCoupon}));}

function load(){
    try{
        const raw=JSON.parse(localStorage.getItem(CART_KEY)); 
        if(raw){
            cart=raw.cart||[]; 
            additions=raw.additions||0; 
            appliedCoupon=raw.appliedCoupon||null;
        }
    }catch(e){
        console.error("Failed to load cart from localStorage", e);
    } 
    render();
}

// Fun√ß√£o de Adicionar ao Carrinho adaptada para os "adicionais"
function addToCart(item) {
  const modsTotalPrice = item.mods.reduce((sum, mod) => sum + mod.price, 0);
  const itemIdentifier = `${item.key}-${item.flavor}-${item.pack}-${item.mods.map(m=>m.id).join('-')}-${item.tema || ''}`;
  const existingItem = cart.find(i => i.identifier === itemIdentifier);

  if (existingItem) {
      existingItem.count++;
  } else {
      item.totalPrice = item.price + modsTotalPrice;
      item.identifier = itemIdentifier;
      item.count = 1;
      cart.push(item);
  }
  
  additions++;
  persist();
  render();
  
  cartBadgeEl.classList.add('jiggle');
  setTimeout(() => cartBadgeEl.classList.remove('jiggle'), 500);

  if (!drawer.classList.contains('open')) {
    openDrawer();
  }
}

// Renderiza√ß√£o do Carrinho com o visual original
function render() {
    cartItemsEl.innerHTML = '';
    if (cart.length === 0) {
        cartItemsEl.innerHTML = '<p style="text-align:center;color:var(--ink);padding:20px;">Seu carrinho est√° vazio.</p>';
    } else {
        cart.forEach((item, idx) => {
            const lineTotal = item.totalPrice * item.count;
            const modsHTML = item.mods && item.mods.length > 0
                ? `<div class="item-extras">${item.mods.map(m => `<div>+ ${m.label} (${moneyBR(m.price)})</div>`).join('')}</div>`
                : '';

            const el = document.createElement('div');
            el.className = 'cart-item';
            el.innerHTML = `
                <div class="item-row">
                    <div class="item-info">
                        <h4>${item.title}</h4>
                        <div class="muted">Sabor: <strong>${item.flavor}</strong></div>
                        <div class="muted">Pacote: <strong>${item.pack} un</strong>${item.tema ? ` ‚Ä¢ Tema: <strong>${item.tema}</strong>` : ''}</div>
                        ${modsHTML}
                        <div class="muted">Pre√ßo unit. (c/ adicionais): <strong>${moneyBR(item.totalPrice)}</strong></div>
                        <div class="muted">Total do item: <strong>${moneyBR(lineTotal)}</strong></div>
                    </div>
                    <div class="qty-col">
                        <div class="qty-ctl">
                            <button aria-label="Diminuir quantidade" data-action="dec" data-index="${idx}">‚àí</button>
                            <span><strong>${item.count}</strong></span>
                            <button aria-label="Aumentar quantidade" data-action="inc" data-index="${idx}">+</button>
                        </div>
                        <button class="rmv" data-action="rmv" data-index="${idx}">Remover</button>
                    </div>
                </div>`;
            cartItemsEl.appendChild(el);
        });
    }

    cartItemsEl.querySelectorAll('[data-action]').forEach(btn => {
        btn.onclick = () => {
            const action = btn.dataset.action;
            const index = parseInt(btn.dataset.index, 10);
            
            if (action === 'inc') {
                cart[index].count++;
            } else if (action === 'dec') {
                cart[index].count = Math.max(1, cart[index].count - 1);
            } else if (action === 'rmv') {
                const itemEl = btn.closest('.cart-item');
                if (itemEl) {
                   itemEl.classList.add('removing');
                   setTimeout(() => {
                       cart.splice(index, 1);
                       persist();
                       render();
                   }, 300);
                   return;
                } else {
                   cart.splice(index, 1);
                }
            }
            persist();
            render();
        };
    });

    const subtotal = cart.reduce((sum, item) => sum + (item.totalPrice * item.count), 0);
    discountAmount = 0;
    if (appliedCoupon) {
        if (appliedCoupon.type === 'percentage') {
            discountAmount = subtotal * (appliedCoupon.value / 100);
        } else if (appliedCoupon.type === 'delivery') {
            discountAmount = deliveryFee > 0 ? deliveryFee : 0;
        }
        discountLineEl.style.display = 'flex';
        discountValueEl.textContent = `-${moneyBR(discountAmount)}`;
    } else {
        discountLineEl.style.display = 'none';
    }
    
    const grandTotal = Math.max(0, subtotal + deliveryFee - discountAmount);
    subtotalValueEl.textContent = moneyBR(subtotal);
    grandTotalValueEl.textContent = moneyBR(grandTotal);
    mobileSubtotal.textContent = `Total: ${moneyBR(grandTotal)}`;
    cartCountEl.textContent = String(cart.reduce((sum, i) => sum + i.count, 0));
}

function openDrawer(){drawer.classList.add('open');}
function closeDrawer(){drawer.classList.remove('open');}

function validateField(el, message) {
  const value = (el.value || '').trim();
  if (!value) {
    showModal(message);
    el.classList.add('invalid-field');
    el.focus();
    setTimeout(() => el.classList.remove('invalid-field'), 1500);
    return false;
  }
  return value;
}

// L√≥gica original de CEP
async function lookup(){
    const dig=onlyDigits(cepInput.value); 
    if(dig.length!==8) return;
    cepSpinner.classList.add('loading');
    try{
      const r=await fetch(`https://viacep.com.br/ws/${dig}/json/`); 
      const d=await r.json();
      if(d && !d.erro){ 
        if(!ruaInput.value)ruaInput.value=d.logradouro||''; 
        if(!bairroInput.value)bairroInput.value=d.bairro||'';
        numeroInput.focus();
      }
    }catch(e){
        console.error("CEP lookup failed", e);
    }
    finally { cepSpinner.classList.remove('loading'); }
}

// --- 5. EVENT LISTENERS & INITIALIZATION ---
// (Listeners da UI Nova)
document.getElementById('openCart').onclick = openDrawer;
document.getElementById('viewCartBtn').onclick = openDrawer;
document.getElementById('closeTop').onclick = closeDrawer;
document.getElementById('continueBtn').onclick = closeDrawer;
document.getElementById('modalCloseBtn').onclick = closeModal;
document.getElementById('modalAddToCartBtn').onclick = () => {
  const cfg = MENU[currentProductKey];
  const flavor = modalForm.querySelector('[name="flavor"]').value;
  const qty = modalForm.querySelector('[name="qty"]').value;
  const tema = modalForm.querySelector('[name="tema"]')?.value.trim() || undefined;
  const basePrice = cfg.flavors[flavor]?.[qty];
  if (!basePrice) { return; }
  const selectedMods = Array.from(modalForm.querySelectorAll('[name="mods"]:checked')).map(mod => ({ id: mod.value, label: mod.parentElement.textContent.trim(), price: parseFloat(mod.dataset.price) }));
  const item = { key: currentProductKey, title: cfg.title, flavor: flavor, pack: qty, price: basePrice, mods: selectedMods, tema: tema };
  addToCart(item);
  closeModal();
};

const dragArea = document.querySelector('.modal-drag-area');
let startY, isDragging = false;
const dragThreshold = 80;
dragArea.addEventListener('touchstart', (e) => { startY = e.touches[0].clientY; isDragging = true; modalBox.classList.add('is-dragging'); });
dragArea.addEventListener('touchmove', (e) => { if (!isDragging) return; const currentY = e.touches[0].clientY; const deltaY = currentY - startY; if (deltaY > 0) { modalBox.style.transform = `translateY(${deltaY}px)`; } });
dragArea.addEventListener('touchend', (e) => { if (!isDragging) return; isDragging = false; modalBox.classList.remove('is-dragging'); if (e.changedTouches[0].clientY - startY > dragThreshold) { closeModal(); } else { modalBox.style.transform = 'translateY(0)'; } });

// (Listeners da L√≥gica Original do Carrinho)
document.querySelectorAll('.segmented button[data-mode]').forEach(b=>{
  b.onclick=()=>{
    const mode=b.dataset.mode;
    document.querySelectorAll('.segmented button[data-mode]').forEach(x=>x.classList.toggle('active',x.dataset.mode === mode));
    document.querySelectorAll('.delivery-box-container').forEach(box => {
      box.style.gridTemplateRows = box.dataset.modeBox === mode ? '1fr' : '0fr';
    });
    deliveryFeeLineEl.style.display = mode === 'entrega' ? 'flex' : 'none';
    if (mode === 'retirada') {
        deliveryFee = 0;
        deliveryFeeValueEl.textContent = 'A calcular';
        appliedCoupon = null;
    }
    render();
  }
});

if(cepInput){
  cepInput.addEventListener('input',()=>{let v=onlyDigits(cepInput.value).slice(0,8); if(v.length>5) v=v.slice(0,5)+'-'+v.slice(5); cepInput.value=v;});
  cepInput.addEventListener('change',lookup);
  cepInput.addEventListener('keyup',()=>{if(onlyDigits(cepInput.value).length===8) lookup();});
}

document.getElementById('calculateFeeBtn').onclick = async () => {
    const street = ruaInput.value.trim();
    const number = numeroInput.value.trim();
    const neighborhood = bairroInput.value.trim();
    if (!street || !number || !neighborhood) { showModal('Por favor, preencha Rua, N√∫mero e Bairro para calcular o frete.'); return; }

    const btn = document.getElementById('calculateFeeBtn');
    btn.disabled = true; btn.innerHTML = 'Calculando...';

    try {
        const response = await fetch('/api/calculate-delivery', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ street, number, neighborhood, cep: cepInput.value.trim() })
        });
        const data = await response.json();
        if (!response.ok) { throw new Error(data.error || 'Ocorreu um erro desconhecido.'); }
        
        let preco = data.cost;
        if (preco > 100) {
            preco = preco / 100;
        }

        deliveryFee = preco;
        deliveryFeeValueEl.textContent = moneyBR(deliveryFee);
        render();
        showModal(`Taxa de entrega calculada: ${moneyBR(deliveryFee)}`, 'üöö');
    } catch (error) {
        showModal(`N√£o foi poss√≠vel calcular o frete: ${error.message}`);
        deliveryFee = 0;
        deliveryFeeValueEl.textContent = 'Erro';
        render();
    } finally {
        btn.disabled = false;
        btn.innerHTML = `<svg style="width:20px; height:20px" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path></svg><span>Calcular Frete</span>`;
    }
};

document.getElementById('applyCouponBtn').onclick = async () => {
    const couponCode = couponInput.value.trim().toUpperCase();
    if (!couponCode) { showModal('Por favor, digite um c√≥digo de cupom.'); return; }

    couponMessageEl.textContent = 'Verificando...'; couponMessageEl.className = '';

    try {
        const response = await fetch('/api/verify-coupon', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ couponCode })
        });
        const data = await response.json();
        if(!response.ok) { throw new Error(data.message || 'Erro ao verificar cupom.'); }

        appliedCoupon = data.coupon;
        couponMessageEl.classList.add('success'); couponMessageEl.textContent = 'Cupom aplicado com sucesso! ‚úÖ';
    } catch (error) {
        appliedCoupon = null;
        couponMessageEl.classList.add('error'); couponMessageEl.textContent = error.message;
    } finally {
        persist();
        render();
    }
};

document.getElementById('checkoutBtn').onclick=()=>{
  if(cart.length===0){showModal('Seu carrinho ainda est√° vazio, flor üå∏');return;}
  const dateValue = dateInput.value;
  const timeValue = timeInput.value;
  if(!dateValue || !timeValue){showModal('Selecione a data e o hor√°rio com carinho üíï');return;}
  
  const chosenDateTime = new Date(`${dateValue}T${timeValue}`);
  if(chosenDateTime - new Date() < 24*60*60*1000 - 60000){
    const m=new Date(Date.now()+24*60*60*1000);
    showModal(`Querida cliente üíï\nPara garantirmos frescor e capricho, precisamos de pelo menos 24 horas de anteced√™ncia.\nSeu pedido poder√° ser feito a partir de: ${formatBR(m)} √†s ${pad2(m.getHours())}:${pad2(m.getMinutes())}.\nObrigada pela compreens√£o!`);
    return;
  }

  let nome;
  const mode=document.querySelector('.segmented button.active').dataset.mode;
  if(mode==='retirada'){
    nome = validateField(document.getElementById('nomeRetirada'), 'Por gentileza, informe o nome para retirada üå∏');
    if (!nome) return;
  }else{
    nome = validateField(document.getElementById('nomeEntrega'), 'Por gentileza, informe o nome para entrega üå∏');
    if (!nome) return;
    if (deliveryFee <= 0 && (!appliedCoupon || appliedCoupon.type !== 'delivery')) {
        showModal('Por favor, calcule a taxa de entrega antes de finalizar o pedido.');
        return;
    }
  }

  const lines=[];
  const subtotal = cart.reduce((sum, item) => sum + (item.totalPrice * item.count), 0);
  const finalDeliveryFee = typeof deliveryFee === 'number' ? deliveryFee : 0;
  const grandTotal = Math.max(0, subtotal + finalDeliveryFee - discountAmount);

  lines.push('Ol√°, La Do√ßura! üç∞ Gostaria de fazer um pedido.','');
  lines.push('Segue o resumo para confirma√ß√£o:','');
  lines.push(`üå∏ *Pedido para:* ${nome}`,'');
  lines.push('*Itens:*');
  cart.forEach((item, i) => {
    let itemLine = `*${i+1})* ${item.count}x ${item.title} (${item.flavor}, ${item.pack} un)`;
    if (item.tema) { itemLine += ` - Tema: ${item.tema}`; }
    lines.push(itemLine);
    if (item.mods && item.mods.length > 0) { item.mods.forEach(mod => { lines.push(`  - Adicional: ${mod.label}`); }); }
    lines.push(`   Subtotal do item: ${moneyBR(item.totalPrice * item.count)}`);
  });
  lines.push('');
  lines.push(`*Valores:*`);
  lines.push(`- Subtotal dos Itens: ${moneyBR(subtotal)}`);
  if(appliedCoupon && discountAmount > 0){ lines.push(`- Desconto (Cupom): -${moneyBR(discountAmount)}`); }
  if(mode === 'entrega'){ lines.push(`- Taxa de Entrega: ${moneyBR(finalDeliveryFee)}`); }
  lines.push(`- *Total Geral:* ${moneyBR(grandTotal)}`);
  lines.push('');
  lines.push(`*Detalhes da Entrega/Retirada:*`);
  lines.push(`üìÖ *Data e Hor√°rio:* ${formatBR(chosenDateTime)} √†s ${timeValue}`);

  if(mode==='retirada'){
    lines.push(`üö∂‚Äç‚ôÄÔ∏è *Modalidade:* Retirada no local.`);
  }else{
    const rua=ruaInput.value.trim();
    const bairro=bairroInput.value.trim();
    const numero=numeroInput.value.trim();
    const cep=cepInput.value.trim();
    const ref=(document.getElementById('ref').value||'').trim();
    lines.push(`üöö *Modalidade:* Entrega.`);
    lines.push(`üìç *Endere√ßo:* ${rua}, N¬∫ ${numero}, Bairro ${bairro}.`);
    if(cep) lines.push(`- CEP: ${cep}`);
    if(ref) lines.push(`- Refer√™ncia: ${ref}`);
  }
  const obs=(document.getElementById('obs').value||'').trim(); 
  if(obs) { lines.push(''); lines.push(`üìù *Observa√ß√µes:* ${obs}`); }
  lines.push('','Aguardo a confirma√ß√£o e as informa√ß√µes para o pagamento. Obrigado(a)! üíñ');
  
  const url=`https://wa.me/${PHONE}?text=${encodeURIComponent(lines.join('\n'))}`; 
  window.open(url,'_blank');
};

const minDate = new Date(Date.now() + 24 * 60 * 60 * 1000);
dateInput.min = toLocalInputValue(minDate);
dateInput.value = dateInput.min;
timeInput.value = `${pad2(minDate.getHours())}:${pad2(minDate.getMinutes())}`;
document.getElementById('y').textContent=new Date().getFullYear();

// Initial calls
renderMenu();
setupFilters();
load();
</script>
</body>
</html>
